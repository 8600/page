<template>
  <div class="main-box" id="main">

  </div>
</template>

<script>
  export default {
    data: {
      app: null,
      loader: null,
      container: null,
      titleContainer: null,
      titleStart: null,
      imgArr: [
        './images/1-title.png'
      ]
    },
    created: function () {
      let bodySize = this.methods.calculationScene(this)
      // console.log(this)
      
      $('#main').append(this.data.app.view)
      this.data.app.stage.displayList = new PIXI.display.Stage()
      var greenGroup = new PIXI.display.Group(1, false)
      // 预加载资源
      this.data.loader = new PIXI.loaders.Loader();
      this.data.loader.add("bgm","audio/bgm.mp3")
        .add("nishuo1","audio/1nishuo.mp3")
        .add("dida","audio/dida.mp3")
        .add(this.data.imgArr)
        .onProgress.add((e) => {
          console.log(e)
        }
      )
      this.data.container = new PIXI.Container()
      this.data.container.interactive = true
      
      // 创建一个容器
      const titleContainer = new PIXI.Container()
      titleContainer.x = 0
      titleContainer.y = 0
      // titleContainer.interactive = true;
      // 加载背景
      const bg1Image = this.methods.createSprite("./images/1.png", {
        width: bodySize.w,
        height: bodySize.h,
        x: 0,
        y: 0
      })
      // 加载首页logo
      const logoImageHeight = bodySize.h / 10
      const logoImageWidth = logoImageHeight * 2.75
      const logoImage = this.methods.createSprite("./images/logo.png", {
        width: logoImageWidth,
        height: logoImageHeight,
        // 位置左下角
        x: 0,
        y: bodySize.h - logoImageHeight
      })

      // 加载顶部标题
      const oneTitleHeight = bodySize.h / 20
      // 保持图片比例
      const oneTitleWidth = oneTitleHeight * 9.818
      const oneTitle = this.methods.createSprite("./images/1-title.png", {
        width: oneTitleWidth,
        height: oneTitleHeight,
        // 位置中间靠上
        x: (bodySize.w / 2) - (oneTitleWidth / 2),
        y: bodySize.h * 0.1
      })

      // 加载时钟
      const clockHeight = bodySize.h / 1.2
      // 保持图片比例
      const clockWidth = clockHeight * 1.7801
      const oneClock = this.methods.createSprite("./images/1-clock.png", {
        width: clockWidth,
        height: clockHeight,
        // 位置中间偏下10像素
        x: (bodySize.w / 2) - (clockWidth / 2),
        y: (bodySize.h * 0.6) - (clockHeight / 2)
      })
      // 加载小手
      const handHeight = bodySize.h / 20
      const oneHand = this.methods.createSprite("./images/1-hand.png", {
        width: handHeight,
        height: handHeight,
        // 位置中间偏下10像素
        x: bodySize.w * 0.4,
        y: (bodySize.h * 0.54) - (handHeight / 2)
      })
      titleContainer.addChild(bg1Image, logoImage, oneTitle, oneClock, oneHand)
      $("#main").on("click",() => {
        console.log('sd')
        // 加载资源
        this.data.loader.load((loader) => {
          // 设置音乐播放模式
          // console.log(loader.resources.bgm.data)
          loader.resources.bgm.data.loop = true
          loader.resources.bgm.data.autoplay = true
          loader.resources.bgm.data.play()
          let titleHandTween = TweenMax.fromTo(oneHand, 1.5, {x: (bodySize.w * 0.43)},{x: (bodySize.w * 0.48), ease:Linear.easeNone}).repeat(-1)
          titleHandTween.play()
          this.data.app.stage.addChild(titleContainer)
        })
      })
      
    },
    methods: {
      // 创建sprite对象
      createSprite: function(name, opt){
        var newSprite = new PIXI.Sprite.from(name);
        if (opt) {
          for (let key in opt) {
            newSprite[key] = opt[key]
          }
        }
        return newSprite;
      },
      // 横竖屏旋转
      calculationScene: function(_this) {
        console.log(_this)
        // 获取屏幕宽高
        const ww = $(window).width()
        const wh = $(window).height()

        // 判断是否为微信
        if (false) {
          if (window.orientation !== 90 && window.orientation !== -90){
            window.document.body.classList.add('horizontal')
            window.document.body.style.width = `${wh}px`
            window.document.body.style.height = `${ww}px`
            window.document.body.style.left = `calc(50% - ${wh / 2}px)`
            window.document.body.style.top = `calc(50% - ${ww / 2}px)`
            // 创建画布
            _this.data.app = new PIXI.Application($(window).height(), $(window).width(), {
              backgroundColor: '0xffffff'
            })
            return {w: wh, h: ww}
          }
        } else {
          if (ww < wh){
            window.document.body.classList.add('horizontal')
            window.document.body.style.width = `${wh}px`
            window.document.body.style.height = `${ww}px`
            window.document.body.style.left = `calc(50% - ${wh / 2}px)`
            window.document.body.style.top = `calc(50% - ${ww / 2}px)`
            // 创建画布
            _this.data.app = new PIXI.Application($(window).height(), $(window).width(), {
              backgroundColor: '0xffffff'
            })
            return {w: wh, h: ww}
          }
        }
        // 创建画布
        _this.data.app = new PIXI.Application($(window).width(), $(window).height(), {
          backgroundColor: '0xffffff'
        })
        return {w: ww, h: wh}
      }
    }
  }
</script>

<style lang="less">
</style>